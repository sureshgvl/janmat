<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="à¤œà¤¨à¤®à¤¤ - à¤°à¤¾à¤œà¤•à¥€à¤¯ à¤¸à¥‹à¤¶à¤² à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤ªà¥à¤²à¥…à¤Ÿà¤«à¥‰à¤°à¥à¤®. à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤šà¥€ à¤®à¤¾à¤¹à¤¿à¤¤à¥€ à¤ªà¤¹à¤¾, à¤µà¥‰à¤°à¥à¤¡ à¤†à¤£à¤¿ à¤•à¥à¤·à¥‡à¤¤à¥à¤°à¤¨à¤¿à¤¹à¤¾à¤¯ à¤šà¥…à¤Ÿ à¤—à¥à¤°à¥à¤ªà¥à¤¸à¤®à¤§à¥à¤¯à¥‡ à¤¸à¤¹à¤­à¤¾à¤—à¥€ à¤µà¥à¤¹à¤¾, à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤¨à¤¾ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤µà¤¿à¤šà¤¾à¤°à¤¾ à¤†à¤£à¤¿ à¤¸à¥à¤¥à¤¾à¤¨à¤¿à¤• à¤¨à¤¿à¤µà¤¡à¤£à¥à¤•à¥€à¤¬à¤¦à¥à¤¦à¤² à¤®à¤¾à¤¹à¤¿à¤¤à¥€ à¤®à¤¿à¤³à¤µà¤¾.">

  <!-- Google Sign-In Client ID for Web Authentication -->
  <meta name="google-signin-client_id" content="231534632940-bdb07b3ca9d1ffcd57aac9.apps.googleusercontent.com">

  <!-- Viewport for mobile-like centering -->
  <meta name="viewport" content="width=390, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- iOS Safari specific -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="JanMat">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://janmat-official.web.app/">
  <meta property="og:title" content="à¤œà¤¨à¤®à¤¤ - à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤¶à¥€ à¤¸à¤‚à¤µà¤¾à¤¦ à¤¸à¤¾à¤§à¤¾">
  <meta property="og:description" content="à¤œà¤¨à¤®à¤¤ - à¤°à¤¾à¤œà¤•à¥€à¤¯ à¤¸à¥‹à¤¶à¤² à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤ªà¥à¤²à¥…à¤Ÿà¤«à¥‰à¤°à¥à¤®. à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤šà¥€ à¤®à¤¾à¤¹à¤¿à¤¤à¥€ à¤ªà¤¹à¤¾, à¤µà¥‰à¤°à¥à¤¡ à¤†à¤£à¤¿ à¤•à¥à¤·à¥‡à¤¤à¥à¤°à¤¨à¤¿à¤¹à¤¾à¤¯ à¤šà¥…à¤Ÿ à¤—à¥à¤°à¥à¤ªà¥à¤¸à¤®à¤§à¥à¤¯à¥‡ à¤¸à¤¹à¤­à¤¾à¤—à¥€ à¤µà¥à¤¹à¤¾, à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤¨à¤¾ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤µà¤¿à¤šà¤¾à¤°à¤¾ à¤†à¤£à¤¿ à¤¸à¥à¤¥à¤¾à¤¨à¤¿à¤• à¤¨à¤¿à¤µà¤¡à¤£à¥à¤•à¥€à¤¬à¤¦à¥à¤¦à¤² à¤®à¤¾à¤¹à¤¿à¤¤à¥€ à¤®à¤¿à¤³à¤µà¤¾.">
  <meta property="og:image" content="https://janmat-official.web.app/icons/Icon-512.png">
  <meta property="og:image:width" content="512">
  <meta property="og:image:height" content="512">
  <meta property="og:image:alt" content="JanMat Logo">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://janmat-official.web.app/">
  <meta property="twitter:title" content="à¤œà¤¨à¤®à¤¤ - à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤¶à¥€ à¤¸à¤‚à¤µà¤¾à¤¦ à¤¸à¤¾à¤§à¤¾">
  <meta property="twitter:description" content="à¤œà¤¨à¤®à¤¤ - à¤°à¤¾à¤œà¤•à¥€à¤¯ à¤¸à¥‹à¤¶à¤² à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤ªà¥à¤²à¥…à¤Ÿà¤«à¥‰à¤°à¥à¤®. à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤šà¥€ à¤®à¤¾à¤¹à¤¿à¤¤à¥€ à¤ªà¤¹à¤¾, à¤µà¥‰à¤°à¥à¤¡ à¤†à¤£à¤¿ à¤•à¥à¤·à¥‡à¤¤à¥à¤°à¤¨à¤¿à¤¹à¤¾à¤¯ à¤šà¥…à¤Ÿ à¤—à¥à¤°à¥à¤ªà¥à¤¸à¤®à¤§à¥à¤¯à¥‡ à¤¸à¤¹à¤­à¤¾à¤—à¥€ à¤µà¥à¤¹à¤¾, à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤¨à¤¾ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤µà¤¿à¤šà¤¾à¤°à¤¾ à¤†à¤£à¤¿ à¤¸à¥à¤¥à¤¾à¤¨à¤¿à¤• à¤¨à¤¿à¤µà¤¡à¤£à¥à¤•à¥€à¤¬à¤¦à¥à¤¦à¤² à¤®à¤¾à¤¹à¤¿à¤¤à¥€ à¤®à¤¿à¤³à¤µà¤¾.">
  <meta property="twitter:image" content="https://janmat-official.web.app/icons/Icon-512.png">
  <meta property="twitter:image:alt" content="JanMat Logo">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/icons/Icon-192.png">
  <link rel="apple-touch-icon" href="/icons/Icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icons/Icon-512.png">

  <!-- Web App Manifest -->
  <link rel="manifest" href="/manifest.json">

  <title>à¤œà¤¨à¤®à¤¤ - à¤‰à¤®à¥‡à¤¦à¤µà¤¾à¤°à¤¾à¤‚à¤¶à¥€ à¤¸à¤‚à¤µà¤¾à¤¦ à¤¸à¤¾à¤§à¤¾</title>

  <!-- Razorpay SDK -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <!-- ... existing favicon and manifest links ... -->

  <style>
    /* Basic responsive styling for Flutter Web */
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Ensure Flutter canvas fits properly */
    canvas {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <script>
    // Smart PWA update handling - only show update prompt when there's actual new content
    if ('serviceWorker' in navigator && !window.location.hostname.includes('localhost')) {
      // Production mode - register service worker with proper update handling
      navigator.serviceWorker.register('/flutter_service_worker.js?v=' + Date.now())
        .then(reg => {
          console.log('ServiceWorker registered:', reg);

          // Check for updates
          reg.update().catch(() => {});

          reg.onupdatefound = () => {
            const newWorker = reg.installing;
            console.log('New ServiceWorker found, installing...');

            if (newWorker) {
              newWorker.onstatechange = () => {
                console.log('New ServiceWorker state:', newWorker.state);

                if (newWorker.state === 'installed') {
                  if (navigator.serviceWorker.controller) {
                    // New version available! Check if user has already been prompted
                    const lastPromptVersion = localStorage.getItem('janmat_last_update_prompt');
                    const currentVersion = localStorage.getItem('janmat_app_version') || '1.0.0';

                    // Fetch current version from version.json
                    fetch('/version.json')
                      .then(response => response.json())
                      .then(versionData => {
                        // Use build_number as more precise version identifier
                        const newVersion = versionData.build_number + '_' + versionData.version;

                        console.log('App version check - Current:', currentVersion, 'New:', newVersion, 'LastPrompt:', lastPromptVersion);

                        // Only show prompt if versions are different AND user hasn't been prompted for this version
                        if (newVersion !== currentVersion && lastPromptVersion !== newVersion) {
                          const shouldUpdate = confirm("ðŸš€ New update available! Click OK to apply and refresh the app.");
                          if (shouldUpdate) {
                            // Update stored version and prompt flag
                            localStorage.setItem('janmat_app_version', newVersion);
                            localStorage.setItem('janmat_last_update_prompt', newVersion);
                            console.log('User accepted update for version:', newVersion);
                            // Force hard refresh to activate new service worker
                            window.location.reload(true);
                          } else {
                            // User dismissed, don't prompt again for this version
                            localStorage.setItem('janmat_last_update_prompt', newVersion);
                            console.log('User dismissed update prompt for version:', newVersion);
                          }
                        } else {
                          console.log('No new update or already prompted for this version');
                        }
                      })
                      .catch(err => {
                        console.log('Could not fetch version.json, using fallback:', err);
                        // Fallback: still show update prompt but less frequently
                        const now = Date.now();
                        const lastPrompt = localStorage.getItem('janmat_update_prompt_time');
                        if (!lastPrompt || (now - parseInt(lastPrompt)) > 24 * 60 * 60 * 1000) { // 24 hours
                          const shouldUpdate = confirm("ðŸš€ New update available! Click OK to apply and refresh the app.");
                          if (shouldUpdate) {
                            localStorage.setItem('janmat_update_prompt_time', now.toString());
                            window.location.reload(true);
                          }
                        }
                      });
                  } else {
                    // First time user - app installed successfully
                    console.log("âœ… PWA installed and ready!");
                    // Clear any old prompt flags on fresh install
                    localStorage.removeItem('janmat_last_update_prompt');
                    localStorage.removeItem('janmat_update_prompt_time');
                  }
                }
              };
            }
          };
        })
        .catch(error => {
          console.log('ServiceWorker registration failed:', error);
        });
    } else if (window.location.hostname.includes('localhost')) {
      // Development mode - skip PWA service worker entirely
      console.log('ðŸ”§ DEVELOPMENT MODE: Skipping service worker registration (localhost)');
    }
  </script>

  <script src="flutter.js" defer></script>
  <script src="main.dart.js" type="application/javascript"></script>
</body>
</html>
